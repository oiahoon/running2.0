name: Deploy Homepage

on:
  push:
    branches: [ master ]
    paths:
      - 'homepage/**'
      - '.github/workflows/deploy-homepage.yml'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: |
        cd homepage
        npm install
        
    - name: Generate sitemap
      run: |
        cd homepage
        cat > sitemap.xml << EOF
        <?xml version="1.0" encoding="UTF-8"?>
        <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
          <url>
            <loc>https://running-page-2.vercel.app/</loc>
            <lastmod>$(date -u +%Y-%m-%d)</lastmod>
            <changefreq>weekly</changefreq>
            <priority>1.0</priority>
          </url>
        </urlset>
        EOF
        
    - name: Generate robots.txt
      run: |
        cd homepage
        cat > robots.txt << EOF
        User-agent: *
        Allow: /
        
        Sitemap: https://running-page-2.vercel.app/sitemap.xml
        EOF
        
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./homepage
        publish_branch: gh-pages-homepage
        
    - name: Deployment Summary
      run: |
        echo "âœ… Homepage deployed successfully!"
        echo "ðŸŒ GitHub Pages URL: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
        echo "ðŸ“ Files deployed from: ./homepage"
